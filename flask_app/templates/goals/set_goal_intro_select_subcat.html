<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/Enso_Blue_and_Black.jpg') }}">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js"></script>
  <script defer src="/static/js/swiper.js"></script>
  <script defer type="module" src="/static/js/goal-manager.js"></script>
  <script defer type="module" src="/static/js/milestone-manager.js"></script>
  <script defer type="module" src="/static/js/action-item-manager.js"></script>
  <script defer type="module" src="/static/js/save-goal.js"></script>
  <script defer type="module" src="/static/js/timeframe-to-date.js"></script>
  <script defer type="module" src="/static/js/sortable-containers.js"></script>

  <title>Goal Entry Introduction</title>
</head>

<body>
  <div class="border-box">
    <nav
      class="navbar navbar-expand-lg navbar-dark bg-dark w-100 m-auto d-flex justify-content-between position-sticky top-0 z-3 p-3">
      <div class="container-fluid">
        <a class="navbar-brand d-inline-flex align-items-center gap-4" href="/home">
          <img src="/static/img/Enso_Blue_and_Black.jpg" alt="Logo" width="60" height="60" class="rounded-circle">
          <h1 class="display-5 text-primary">Converge</h1>
        </a>
      </div>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDarkDropdown1"
        aria-controls="navbarNavDarkDropdown1" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDarkDropdown1">
        <div class="navbar-nav">
          <a class="nav-link active" aria-current="page" href="/home">Home</a>
          <a class="nav-link" href="/calendar">Calendar</a>
          <div class="collapse navbar-collapse">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <button class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  Goals
                </button>
                <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="/goals/your-why">Understanding Your WHY</a></li>
                  <li><a class="dropdown-item" href="/goals/recreation-travel">Recreation and
                      Travel</a></li>
                  <li><a class="dropdown-item" href="/goals/health-wellness">Health and Wellness</a>
                  </li>
                  <li><a class="dropdown-item" href="/goals/social-community">Social and Community
                      Engagement</a></li>
                  <li><a class="dropdown-item" href="/goals/spirituality">Spirituality and Life
                      Purpose</a></li>
                  <li><a class="dropdown-item" href="/goals/career-professional-development">Career
                      and Professional Development</a></li>
                  <li><a class="dropdown-item" href="/goals/wealth-finance">Wealth Building and
                      Financial Health</a></li>
                  <li><a class="dropdown-item" href="/goals/creative-expression-hobbies">Creative
                      Expression and Hobbies</a></li>
                  <li><a class="dropdown-item" href="/goals/environment-success">Environment and
                      Success</a></li>
                  <li><a class="dropdown-item" href="/goals">Something else here</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="collapse navbar-collapse">
            <ul class="navbar-nav">
              <li class="nav-item dropdown">
                <button class="btn btn-dark dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                  Practices
                </button>
                <ul class="dropdown-menu dropdown-menu-dark">
                  <li><a class="dropdown-item" href="/practices/AM">AM Practices</a></li>
                  <li><a class="dropdown-item" href="/practices/PM">PM Practices</a></li>
                  <li><a class="dropdown-item" href="/practices/daily">Daily Practices</a></li>
                  <li><a class="dropdown-item" href="/practices/discipline">Discipline</a></li>
                  <li><a class="dropdown-item" href="/practices">Something else?</a></li>
                </ul>
              </li>
            </ul>
          </div>
          <a class="nav-link disabled" aria-disabled="true">Disabled</a>
          <form action="/users/logout" method="post">
            <button class="btn btn-link" type="submit" name="logout">logout</button>
          </form>
        </div>
      </div>
    </nav>
    <header class="bg-dark opacity-75 w-100 p-2 pb-3 text-center">
      <h1 class="display-2 mb-3 text-primary">Let's set a goal!</h1>
      <h4 class="display-6 mx-5">Think of something you've always wanted to do...</h4>
    </header>
    <!-- Content and Sidebar Div-->
    <div class="container-fluid m-auto my-3 d-flex align-items-start gap-3">

      <!-- Progress Nav Sidebar -->
      <div class="card shadow p-2 opacity-75 col-3">
        <nav id="progress-navbar" class="h-100 flex-column align-items-stretch p-3">
          <h4 class="display-6 text-primary text-center">You are here.</h4>
          <hr class="border border-1 border-light">
          <nav class="nav nav-pills flex-column">
            <a class="nav-link text-light" href="/surveys/your-why/intro">Define Your WHY</a>
            <hr class="border border-primary">
            <a class="nav-link text-light" href="#recreation-travel">Recreation and Travel</a>
            <nav class="nav nav-pills flex-column">
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/frequent-hobbies-activities">-
                Frequent Hobbies and
                Activities</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/adventure-travel">- Adventure
                and Travel</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/family-group-events">- Family
                and Group Events</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/cultural-exploration">- Cultural
                Exploration</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/special-events">-
                Special Events</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/competitive-events">-
                Competitive Events</a>
              <a class="nav-link ms-3 my-1 text-light" href="/surveys/recreation-travel/bucket-list">- The
                Bucket List</a>
              <a class="nav-link ms-3 my-1 text-light" href="#item-1-2">- Item 1-2</a>
            </nav>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#health-wellness">Health and Wellness</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#social-community">Social and Community Engagement</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#spirituality-life-purpose">Spirituality and Life
              Purpose</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#career-professional-development">Career and Professional
              Development</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#wealth-finance">Wealth Building and Financial Health</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#creative-expression-hobbies">Creative Expression and
              Hobbies</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#environment-success">Environment and Success</a>
            <hr class="border border-light">
            <a class="nav-link text-light" href="#item-3">Item 3</a>
            <nav class="nav nav-pills flex-column">
              <a class="nav-link ms-3 my-1 text-light" href="#item-3-1">Item 3-1</a>
              <a class="nav-link ms-3 my-1 text-light" href="#item-3-2">Item 3-2</a>
            </nav>
          </nav>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="container col-9 opacity-75"> 
        <div class="card shadow mb-2">
          <div class="card-body">
            <div class="card-title">
              <h4 class="text-primary text-center display-6">How would you categorize this goal?</h4>
            </div>
            <div data-bs-spy="scroll" data-bs-target="#progress-navbar" data-bs-smooth-scroll="true"
              class="scrollspy-example-2" tabindex="0">
              <div class="container-fluid p-2 mb-3">
            
                <div class="form-floating">
                  <label for="categorySelect" class="form-label">Select Category:</label>
                  <select id="categorySelect" class="form-select w-50 m-auto mb-1" aria-label="Floating label select">
                    <option value="" selected disabled>Choose a category</option>
                  </select>
                </div>
            
                <div class="form-floating mb-3">
                  </select>
                  <label for="subcategorySelect" class="form-label" aria-label="Floating label select">Select Subcategory:</label>
                  <select id="subcategorySelect" class="form-select w-50 m-auto" disabled>
                    <option value="" selected>Choose a subcategory</option>
                  </select>
                </div>

                <div class="text-center">
                  <a href="/goals/intro/"
                    class="btn w-25 btn-primary mt-3 d-none" id="next-btn">Next Section</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</body>
<script>
  document.addEventListener("DOMContentLoaded", function() {

    let categoriesWithSubcats = {}; // Store practices grouped by category
    initializeDropdowns()
    
    // Fetch all practices from the backend
    async function fetchCategories() {
    try {
      const response = await fetch('/api/categories-with-practices/all'); // Adjust route as needed
      if (!response.ok) throw new Error('Failed to fetch practices');
      return await response.json(); // Returns structured category-practices data
    } catch (error) {
      console.error("Error fetching practices:", error);
      return {}; // Return empty object if there's an error
      }
    }
    
    async function initializeDropdowns() {
      
      categoriesWithSubcats = await fetchCategories();
      
      console.log(categoriesWithSubcats)
      
      // Initialize practices data
      
      // Populate category dropdown
      const categorySelect = document.getElementById("categorySelect");
      const subcategorySelect = document.getElementById("subcategorySelect");
      
      Object.keys(categoriesWithSubcats).forEach(category_id => {
        const category = categoriesWithSubcats[category_id];
        const option = document.createElement("option");
        option.value = category_id;
        option.textContent = category["category_name"]
        option.setAttribute("data-category-slug", category["category_slug"]);
        categorySelect.appendChild(option);
        
      });
      
      // Handle category selection change
      categorySelect.addEventListener("change", function() {
        const selectedCategory = this.value;
        
        subcategorySelect.innerHTML = `<option value="">Choose a subcategory</option>`; // Reset options
        subcategorySelect.disabled = true;
        
        if (selectedCategory) {
          const subcategories = categoriesWithSubcats[selectedCategory].subcategories;
          subcategories.forEach(subcat => {
            const option = document.createElement("option");
            option.value = subcat["subcategory_id"];
            option.textContent = subcat["subcategory_name"];
            option.setAttribute("data-subcategory-slug", subcat["subcategory_slug"])
            subcategorySelect.appendChild(option);
          });
          
          subcategorySelect.disabled = false;
        }
      });
      
      subcategorySelect.addEventListener("change", function() {
        const selectedSubcategory = this.options[this.selectedIndex];
        const nextButton = document.getElementById("next-btn")
        
        if (selectedSubcategory) {
          console.log("Subcategory selected")
          if (selectedSubcategory.hasAttribute("data-subcategory-slug")) {
            subcategorySlug = selectedSubcategory.dataset.subcategorySlug
            console.log(subcategorySlug)
            nextButton.setAttribute("href", `/goals/intro/${subcategorySlug}`)
            nextButton.classList.remove("d-none")
            console.log(`Next Button after: ${nextButton}`)
          }
        }
      })
    }
  });
  </script>
</html>